---
layout:     post   				    # ä½¿ç”¨çš„å¸ƒå±€ï¼ˆä¸éœ€è¦æ”¹ï¼‰
title:      ç½‘ç«™çˆ¬å–å¿ƒå¾—  				# æ ‡é¢˜ 
subtitle:   C#ç½‘ç«™çˆ¬è™«å¿ƒå¾—-å·¥å…·Html Agility Pack #å‰¯æ ‡é¢˜
date:       2018-8-1				# æ—¶é—´
author:     Replay 						# ä½œè€…
header-img: img/post-bg-js-version.jpg 	#è¿™ç¯‡æ–‡ç« æ ‡é¢˜èƒŒæ™¯å›¾ç‰‡
catalog: true 						# æ˜¯å¦å½’æ¡£
tags:								#æ ‡ç­¾
    - ç¬”è®°
    - UWP
    - ç½‘ç»œçˆ¬è™«
    - C#
    - Html Agility Pack
---

## Foreword
> çˆ¬è™«è™½æ–¹ä¾¿...
> 
> è¯·å¤§å®¶æ”¯æŒåŸç‰ˆå†…å®¹ğŸ™ƒğŸ™ƒğŸ™ƒğŸ™ƒã€‚

## Html Agility Pack å·¥å…·ç®€ä»‹

[Html Agility Pack](http://html-agility-pack.net/) ä½œä¸ºä¸€ä¸ªHTMLè§£æå™¨ã€‚å¯¹ä¸å¤§å¤šæ•°è§£æå™¨æ¥è¯´ï¼Œå®ƒå¿«é€Ÿï¼Œå¹¶ä¸”æœ‰éå¸¸å¤§çš„â€œå®¹é”™æ€§â€ï¼ˆæ ¼å¼é”™è¯¯å¹¶ä¸ä¼šå½±å“è§£æã€‚ä¾‹ï¼šhtmlçš„æ ‡ç­¾ç¼ºå°‘æƒ…å†µå¹¶ä¸å½±å“è§£æ......ï¼‰

Html Agility Pack åŸºäº [.NetCore](https://www.microsoft.com/net/download)ã€‚ ç†è®ºä¸Šå¯ä»¥è¿›è¡Œè·¨å¹³å°ä½¿ç”¨ï¼ˆå…·ä½“æœªæµ‹è¯•ï¼‰ã€‚

## Html Agility Pack åº”ç”¨

### åŠ è½½Html

Html Agility Pack æ”¯æŒä»æœ¬åœ°æ–‡ä»¶ä¸­åŠ è½½ï¼Œå­—ç¬¦ä¸²åŠ è½½å’Œé€šè¿‡ç½‘é¡µURLé“¾æ¥åŠ è½½

```CSharp
...

// From File
var doc = new HtmlDocument();
doc.Load(filePath);

// From String
var doc = new HtmlDocument();
doc.LoadHtml(html);

// From Web
var url = "http://html-agility-pack.net/";
var web = new HtmlWeb();
var doc = web.Load(url);

...
```

### è·å–èŠ‚ç‚¹ã€‚æ”¯æŒXpath,å¹¶æ”¯æŒLinq

```CSharp
...

// With XPath 
var value = doc.DocumentNode
 .SelectNodes("//td/input")
 .First()
 .Attributes["value"].Value;
 
// With LINQ 
var nodes = doc.DocumentNode.Descendants("input")
 .Select(y => y.Descendants()
 .Where(x => x.Attributes["class"].Value == "box"))
 .ToList();

...
```

### èŠ‚ç‚¹å†…å®¹çš„è¯»å–æ“ä½œ
```CSharp
...

html=@"
        <root>
            <h3 id="h3_name">
            </h3>
            hello world!
        </root>
        "

var doc = new HtmlDocument();
doc.LoadHtml(html);

//OuterHtml 
var outerHtml = doc.DocumentNode.OuterHtml;
//outerHtml ç»“æœä¸ºï¼š<root>
//                      <h3 id="h3_name">
//                      </h3>
//                       hello world!
//                 </root>

// InnerHtml  
var innerHtml = doc.DocumentNode.InnerHtml;
//innerHtml ç»“æœä¸ºï¼š<h3 id="h3_name">
//                  </h3>
//                  hello world!

// InnerText 
var innerText = doc.DocumentNode.InnerText;
//innerText ç»“æœä¸ºï¼šhello world!

...
```

### å¹¶ä¸”å¯ä»¥å¯¹èŠ‚ç‚¹çš„å±æ€§è¿›è¡Œæ“ä½œ
```CSharp
...

var htmlNode = doc.DocumentNode.SelectSingleNode("//h3");
//è·å–èŠ‚ç‚¹å±æ€§çš„å€¼
var nodeId = htmlNode.Attributes["id"].Value;
//nodeIdçš„ç»“æœä¸ºï¼š h3_name

//æ›´æ”¹èŠ‚ç‚¹å±æ€§çš„å€¼
htmlNode.SetAttributeValue("id", "alter_h3_name");
//æ­¤æ—¶ htmlçš„å†…å®¹å˜ä¸ºï¼š<root>
//                      <h3 id="alter_h3_name">
//                      </h3>
//                      hello world!
//                  </root>

...
```

### å¯ä»¥ç§»é™¤ä¸éœ€è¦çš„HTMLå†…å®¹

```CSharp
...
//ç§»é™¤èŠ‚ç‚¹æœ‰å¾ˆå¤šæ–¹æ³•ï¼Œè¿™é‡Œåªç¤ºä¾‹ä¸€ä¸ªã€‚
htmlNode.RemoveAll(); 
//ç§»é™¤äº† <h3>èŠ‚ç‚¹
//æ­¤æ—¶ åŸ html å†…å®¹ä¸ºï¼š<root>
//                      hello world!
//                   </root>

...
```

## å¤„ç†æ‰’å–å†…å®¹å¿ƒå¾—

å¤„ç†å®Œæˆåï¼Œå°±è¦æ˜¾ç¤ºéœ€è¦çš„å†…å®¹ã€‚

æœ€è¿‘åœ¨åšUWPåº”ç”¨ï¼Œè¿™é‡Œä½¿ç”¨çš„ UWPçš„ Xaml æ§ä»¶ WebViewã€‚

å¾€htmlå†…å®¹ä¸­æ·»åŠ  CSSï¼Œæ¥è‡ªå®šä¹‰æ–‡ç« å¸ƒå±€ã€‚

å¾€htmlå†…å®¹ä¸­æ·»åŠ  JavaScript è„šæœ¬ï¼Œè¾¾åˆ°å¤–éƒ¨æ§åˆ¶ç½‘é¡µçš„ç›®çš„ã€‚

```CSharp
...

//è·å– h3 css æ ·å¼
private string GetH3Style()
{
        string fontColor = RootPage.Current.RequestedTheme != ElementTheme.Dark ?
        "color : #000000 !important;" : " color : #ffffff !important;";

        return fontColor + " padding:15px 15px 15px 15px !important;";
}
//è·å–ä¸»è¦æ˜¾ç¤ºå†…å®¹ step_outer css æ ·å¼
private string GetStep_outer_Style()
{
    string fontColor = RootPage.Current.RequestedTheme != ElementTheme.Dark ?
        "color : #000000 !important;" : " color : #ffffff !important;";

    return fontColor + " padding:15px 15px 15px 15px !important;";
}
//è·å–ç½‘é¡µèƒŒæ™¯ body css æ ·å¼
private string GetContent_main_outer_Style()
{
    string content_main_outer_color = RootPage.Current.RequestedTheme != ElementTheme.Dark ?
                    " background-color : #ffffff;" :
                    " background-color : #1e1e1e;";

    return content_main_outer_color;
}
//å¾—åˆ°æœ€ç»ˆçš„ css æ ·å¼ï¼Œç”¨æ¥æ·»åŠ åˆ°htmlå†…å®¹ä¸­
public string GetCSS()
{
     string content_main_outer_Style = "body { " + GetContent_main_outer_Style() + " }";

    string h3_Style = "h3{" + GetH3Style() + "}";

    string step_outer_Style = ".step_outer {" + GetStep_outer_Style() + "}";

    return content_main_outer_Style + h3_Style + step_outer_Style;
}
//æ·»åŠ Js è„šæœ¬ï¼Œç”¨æ¥åŠ å…¥åˆ°htmlå†…å®¹ä¸­ã€‚
public string GetJavaScript()
{
    string script = @"function setColor(fontColorCss, backgroundColorCss) 
                        {                       
                            document.getElementsByClassName('step_outer')[0].style.cssText = fontColorCss;
                            var elements = document.getElementsByTagName('h3');
                            for (var i = 0;i < elements.length;i++)
		                    {
			                     elements[i].style.cssText = fontColorCss;
		                    }
                            document.getElementsByTagName('body')[0].style.cssText = backgroundColorCss;
                    }; 
                    function removeDialog()
                     {
                        document.getElementsByTagName('div')[0].innerHTML='';
                    };
                    ";
    return script;
}

/// <summary>
/// åˆ‡æ¢ä¸»é¢˜è‰²
/// </summary>
/// <returns></returns>
public async Task ChangeTheme()
{
    //æ‰§è¡Œjsè„šæœ¬ä¸­çš„ setColor è„šæœ¬ï¼Œä¼ å…¥å‚æ•°ã€‚
    await webView.InvokeScriptAsync("setColor", new[] { GetStep_outer_Style(), GetContent_main_outer_Style() });
}

/// <summary>
/// å»æ‰ä¸éœ€è¦çš„æ¨¡å—, è§£å†³åŠ¨æ€ç½‘é¡µåŠ¨æ€åŠ è½½å†…å®¹çš„æ¶ˆé™¤
/// </summary>
/// <returns></returns>
public async Task Remove()
{
    //æ‰§è¡Œjsè„šæœ¬ä¸­çš„ removeDialog è„šæœ¬ï¼Œä¼ å…¥å‚æ•°ã€‚
    await webView.InvokeScriptAsync("removeDialog", null);
}

...
```

## Talks

[Html Agility Pack](http://html-agility-pack.net/)

[æ³•å·é˜¿å…´-C# ç½‘ç»œçˆ¬è™«åˆ©å™¨ä¹‹Html Agility Packå¦‚ä½•å¿«é€Ÿå®ç°è§£æHtml](https://www.cnblogs.com/xuliangxing/p/8004403.html)